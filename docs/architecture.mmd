graph TD
    subgraph "User Interaction"
        User(("End User")) --> WebDashboard["Web Dashboard (React)"]
        User --> RPiDisplay["Raspberry Pi Display"]
    end

    subgraph "Infrastructure & Web Tier"
        WebDashboard -- HTTPS --> Nginx["Nginx Reverse Proxy"]
        Nginx --> Gunicorn["Gunicorn WSGI"]
        Gunicorn --> FastAPI["FastAPI Application"]
    end

    subgraph "Core Backend Services"
        FastAPI --> Auth["Authentication (JWT)"]
        FastAPI --> Payments["Payments (Stripe)"]
        FastAPI --> Subscriptions["Subscription Logic"]
        FastAPI --> WebSocket["WebSocket Gateway"]
        FastAPI --> DataAccess["Data Access Layer"]
    end

    subgraph "Data & AI"
        DataAccess --> DB["PostgreSQL DB"]
        DataAccess --> Cache["Redis Cache"]
        FastAPI --> AIDiagnostics["AI Diagnostics Service"]
        AIDiagnostics --> Claude["Claude API"]
        AIDiagnostics --> AnomalyModel["Anomaly Detection Model"]
        MLOps["ML Self-Learning"] -- Retrains --> AnomalyModel
        MLOps -- Reads Data --> DB
    end

    subgraph "Vehicle Interface"
        RPiClient["Raspberry Pi Client"] -- OBD-II --> Vehicle["Vehicle CAN Bus"]
        RPiClient -- Secure WebSocket --> WebSocket
    end

    subgraph "Operations"
        CICD["CI/CD (GitHub Actions)"] --> Docker["Docker Builds"]
        Docker --> Nginx
        Docker --> FastAPI
        Docker --> DB
        Monitoring["Monitoring (Prometheus/Grafana)"] --> FastAPI
        Backup["Backup System"] --> DB
    end

    style User fill:#cde,stroke:#333
    style WebDashboard fill:#f9f,stroke:#333
    style RPiDisplay fill:#ccf,stroke:#333
    style FastAPI fill:#9f9,stroke:#333
